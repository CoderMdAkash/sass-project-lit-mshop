/*! Image Uploader - v1.2.3 - 26/11/2019
 * Copyright (c) 2019 Christian Bayer; Licensed MIT */(function(n){n.fn.imageUploader=function(x){let r,v={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse",extensions:[".jpg",".jpeg",".png",".gif",".svg"],mimes:["image/jpeg","image/png","image/gif","image/svg+xml"],maxSize:void 0,maxFiles:void 0},t=this,l=new DataTransfer;t.settings={},t.init=function(){t.settings=n.extend(t.settings,v,x),t.each(function(e,s){let a=T();if(n(s).append(a),a.on("dragover",m.bind(a)),a.on("dragleave",m.bind(a)),a.on("drop",u.bind(a)),t.settings.preloaded.length){a.addClass("has-files");let i=a.find(".uploaded");for(let d=0;d<t.settings.preloaded.length;d++)i.append(c(t.settings.preloaded[d].src,t.settings.preloaded[d].id,!0))}})};let T=function(){let e=n("<div>",{class:"image-uploader"});r=n("<input>",{type:"file",id:t.settings.imagesInputName+"-"+k(),name:t.settings.imagesInputName+"[]",accept:t.settings.extensions.join(","),multiple:""}).appendTo(e),n("<div>",{class:"uploaded"}).appendTo(e);let s=n("<div>",{class:"upload-text"}).appendTo(e);return n("<i>",{class:"fa fa-cloud"}).appendTo(s),n("<span>",{text:t.settings.label}).appendTo(s),e.on("click",function(a){p(a),r.trigger("click")}),r.on("click",function(a){a.stopPropagation()}),r.on("change",u.bind(e)),e},p=function(e){e.preventDefault(),e.stopPropagation()},c=function(e,s,a){let i=n("<div>",{class:"uploaded-image"}),d=(n("<img>",{src:e}).appendTo(i),n("<button>",{class:"delete-image"}).appendTo(i));return n("<i>",{class:"fa fa-times"}).appendTo(d),a?(i.attr("data-preloaded",!0),n("<input>",{type:"hidden",name:t.settings.preloadedInputName+"[]",value:s}).appendTo(i)):i.attr("data-index",s),i.on("click",function(o){p(o)}),d.on("click",function(o){p(o);let f=i.parent();if(i.data("preloaded")===!0)t.settings.preloaded=t.settings.preloaded.filter(function(g){return g.id!==s});else{let g=parseInt(i.data("index"));f.find(".uploaded-image[data-index]").each(function(h,z){h>g&&n(z).attr("data-index",h-1)}),l.items.remove(g),r.prop("files",l.files)}i.remove(),f.children().length||f.parent().removeClass("has-files")}),i},m=function(e){p(e),e.type==="dragover"?n(this).addClass("drag-over"):n(this).removeClass("drag-over")},u=function(e){p(e);let s=n(this),a=Array.from(e.target.files||e.originalEvent.dataTransfer.files),i=[];n(a).each(function(d,o){t.settings.extensions&&!b(o)||t.settings.mimes&&!j(o)||t.settings.maxSize&&!y(o)||t.settings.maxFiles&&!$(i.length,o)||i.push(o)}),i.length?(s.removeClass("drag-over"),w(s,i)):r.prop("files",l.files)},b=function(e){return!(t.settings.extensions.indexOf(e.name.replace(new RegExp("^.*\\."),"."))<0)||(alert(`The file "${e.name}" does not match with the accepted file extensions: "${t.settings.extensions.join('", "')}"`),!1)},j=function(e){return!(t.settings.mimes.indexOf(e.type)<0)||(alert(`The file "${e.name}" does not match with the accepted mime types: "${t.settings.mimes.join('", "')}"`),!1)},y=function(e){return!(e.size>t.settings.maxSize)||(alert(`The file "${e.name}" exceeds the maximum size of ${t.settings.maxSize/1024/1024}Mb`),!1)},$=function(e,s){return!(e+l.items.length+t.settings.preloaded.length>=t.settings.maxFiles)||(alert(`The file "${s.name}" could not be added because the limit of ${t.settings.maxFiles} files was reached`),!1)},w=function(e,s){e.addClass("has-files");let a=e.find(".uploaded"),i=e.find('input[type="file"]');n(s).each(function(d,o){l.items.add(o),a.append(c(URL.createObjectURL(o),l.items.length-1),!1)}),i.prop("files",l.files)},k=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}})(jQuery);
